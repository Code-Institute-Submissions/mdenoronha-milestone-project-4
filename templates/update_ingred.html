{% extends 'base.html' %} {% block content %}

<h1 class="add-recipe-title">Update a Recipe</h1>

<div class="container stage-tracker">
    <a href="{{url_for('update_recipe_info', recipe_id=recipe_id)}}" class="btn-floating"><i class="material-icons">local_dining</i></a>
    <a href="{{url_for('update_recipe_ingredients', recipe_id=recipe_id)}}" class="btn-floating"><i class="material-icons">local_grocery_store</i></a>
    <a class="btn-floating disabled"><i class="material-icons">add</i></a>
</div>
<div class="container stage-tracker">
    <p>Recipe Info</p>
    <p>Ingredients</p>
    <p>Submit</p>
</div>




<div class="container form-container add-ingredient-container">
    <div class="add-ingredient-list">
        <form class="ingredient-form" method="POST" enctype="multipart/form-data">

            {% for k, v in all_ingreds.items() %} {% if loop.index0 == 0 %}
            <div class="ingredient-inputs example-ingredient">
                {% else %}
                <div class="ingredient-inputs">
                    {% endif %}
                    <h6>Ingredient</h6>
                    <div class="row">
                        <div class="col s4">
                            <div class="input-field">
                                <input placeholder="0.5" required value="{{v.amount}}" name="amount" id="amount_1" type="text" class="validate">
                                <label>Amount</label>
                            </div>
                        </div>
                        <div class="col s4">
                            <div class="input-field">
                                <input placeholder="KG" value="{{v.unit}}" name="unit" id="unit_1" type="text" class="validate">
                                <label>Unit</label>
                            </div>
                        </div>
                        <div class="col s4">
                            <div class="input-field">
                                <input placeholder="Rice" value="{{v.name}}" required name="ingredient" id="ingredient_1" type="text" class="validate">
                                <label>Ingredient</label>
                            </div>
                        </div>
                    </div>
                    <div class="row ingredient-allergy-info">
                        <div class="col m12 s7">
                            <div class="row">
                                <div class="col m4 s12">
                                    <label>
                            <!--When adding new row, name needs to increment-->
                            <input type="checkbox" name="vegetarian-{{loop.index0}}" value="vegetarian" class="filled-in vegetarian" {% if v.is_vegetarian %}checked{% endif %}/>
                            <span>Vegetarian</span>
                        </label>
                                </div>
                                <div class="col m4 s12">
                                    <label>
                            <input type="checkbox" name="vegan-{{loop.index0}}" value="vegan" class="filled-in vegan" {% if v.is_vegan %}checked{% endif %}/>
                        <span>Vegan</span>
                        </label>
                                </div>
                                <div class="col m4 s12">
                                    <label>
                            <input type="checkbox" name="gluten-free-{{loop.index0}}" value="gluten-free" class="filled-in gluten-free" {% if v.is_gluten_free %}checked{% endif %}/>
                            <span>Gluten Free</span>
                        </label>
                                </div>
                            </div>
                        </div>
                        {% if loop.index0 > 1 %}
                        <div class="col m12 s5">
                            <a class="btn-floating right delete-recipe"><i class="material-icons">delete_forever</i></a>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <a class="right add-recipe btn-floating"><i class="material-icons">add</i></a>
            <button class="btn">Submit</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script>
        function update_checkbox_name() {
        check = $('input[type="checkbox"]')
        check.removeAttr('name')
        
        
        var loop_check = 2
        var name_num = 0
        for(i=0; i < check.length; i++) {
            if(loop_check == i) {
                loop_check += 3
                name_num += 1
            }
            $(check[i]).attr('name', $(check[i]).val() + '-' + name_num)
        }
    }

    function ingredients_limit() {
        ingredients = $('.ingredient-inputs')
        if(ingredients.length > 20) {
            $(".add-recipe").attr('disabled', true);
        } else {
            $(".add-recipe").attr('disabled', false);
        }
    }

    $(document).ready(function() {
        $('select').formSelect();
    });

    $('.add-recipe:not([disabled])').on("click", function() {
        $(".example-ingredient").clone().removeClass("example-ingredient").addClass("temp-class").appendTo(".ingredient-form")
        $(".temp-class .ingredient-allergy-info").append('<div class="col m12 s5"><a class="btn-floating right delete-recipe"><i class="material-icons">delete_forever</i></a></div>')
        $(".temp-class input[name='amount']").val("").removeClass("valid");
        $(".temp-class input[name='unit']").val("").removeClass("valid");
        $(".temp-class input[name='ingredient']").val("").removeClass("valid");
        $(".temp-class input[value='gluten-free']").prop('checked', false);
        $(".temp-class input[value='vegan']").prop('checked', false);
        $(".temp-class input[value='vegetarian']").prop('checked', false);
        $(".temp-class").removeClass('temp-class')
        update_checkbox_name()
        ingredients_limit()
    })

    $(".add-ingredient-container").on("click", '.delete-recipe', function() {
        $(this).closest($(".ingredient-inputs")).remove()
        update_checkbox_name()
        ingredients_limit()
    })
    
    $(".add-ingredient-container").on("click", '.vegan', function() {
       if($(this).is(':checked')) {
            $(this).closest($(".ingredient-allergy-info")).find(".vegetarian").prop("checked", true)
        }
    })
    

    $(".add-ingredient-container").on("click", '.vegetarian', function() {
        if(!$(this).is(':checked')) {
            $(this).closest($(".ingredient-allergy-info")).find(".vegan").prop("checked", false)
        }
    })
    </script>

    {% endblock %}
